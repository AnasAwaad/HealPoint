@model IEnumerable<CategoryListDto>

@{
	ViewData["Title"] = "Create Category";
}

<div class="d-flex flex-column flex-column-fluid">

	<!--begin::Toolbar-->
	<div id="kt_app_toolbar" class="app-toolbar  py-3 py-lg-6 ">

		<!--begin::Toolbar container-->
		<div id="kt_app_toolbar_container" class="d-flex justify-content-between w-100">
			<!--begin::Page title-->
			<div class="page-title d-flex flex-column justify-content-center flex-wrap me-3 ">
				<!--begin::Title-->
				<h1 class="page-heading d-flex text-gray-900 fw-bold fs-3 flex-column justify-content-center my-0">
					Categories
				</h1>
				<!--end::Title-->
			</div>
			<!--end::Page title-->
		</div>
		<!--end::Toolbar container-->
	</div>
	<!--end::Toolbar-->
	<!--begin::Content-->
	<div id="kt_app_content" class="app-content  flex-column-fluid ">
		<!--begin::Content container-->
		<div id="kt_app_content_container">
			<!--begin::Category-->
			<div class="card card-flush">
				<!--begin::Card header-->
				<div class="card-header align-items-center py-5 gap-2 gap-md-5">
					<!--begin::Card toolbar-->
					<div class="card-toolbar flex-row-fluid justify-content-end gap-5">
						<!--begin::Add product-->
						<a asp-controller="Categories" asp-action="Create" class="btn btn-primary">
							Add Category
						</a>
						<!--end::Add product-->
					</div>
					<!--end::Card toolbar-->
				</div>
				<!--end::Card header-->
				<!--begin::Card body-->
				<div class="card-body pt-0">

					@if (!Model.Any())
					{
						<div class="alert alert-dismissible bg-light-warning d-flex flex-column flex-sm-row w-100 p-5 mb-10">
							<!--begin::Icon-->
							<i class="ki-duotone ki-message-text-2 fs-2hx text-warning me-4 mb-5 mb-sm-0"><span class="path1"></span><span class="path2"></span><span class="path3"></span></i>                    <!--end::Icon-->
							<!--begin::Content-->
							<div class="d-flex flex-column pe-0 pe-sm-10">
								<h4 class="fw-semibold">This is an alert</h4>
								<span>No Categories available.</span>
							</div>
							<!--end::Content-->
						</div>
					}
					else
					{
						<!--begin::Table-->
						<div class="table-responsive">
							<table class="table">
								<thead>
									<tr class="fw-bold fs-6 text-gray-800">
										<th>Name</th>
										<th>Description</th>
										<th>Created On</th>
										<th>Last Updated On</th>
										<th>Status</th>
										<th class="text-center">Actions</th>
									</tr>
								</thead>
								<tbody>
									@foreach (var category in Model)
									{
										<tr>
											<td>@category.Name</td>
											<td>@category.Description</td>
											<td>@category.CreatedOn</td>
											<td class="js-last-updated-on">@category.LastUpdatedOn</td>
											<td><div class="js-status badge badge-light-@(category.IsDeleted ? "danger":"success")">@(category.IsDeleted ? "Deleted" : "Active")</div></td>
											<td class="text-center">
												<a href="#" class="btn btn-sm btn-light btn-active-light-primary btn-flex btn-center show menu-dropdown" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
													Actions
													<i class="ki-duotone ki-down fs-5 ms-1"></i>
												</a>
												<!--begin::Menu-->
												<div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-150px py-4" data-kt-menu="true" style="z-index: 107; position: fixed; inset: 0px 0px auto auto; margin: 0px; transform: translate(-220px, 299px);" data-popper-placement="bottom-end">
													<!--begin::Menu item-->
													<div class="menu-item px-3">
														<a asp-controller="Categories" asp-action="Update" asp-route-id="@category.Id" class="menu-link px-3">
															Update
														</a>
													</div>
													<!--end::Menu item-->
													<!--begin::Menu item-->
													<div class="menu-item px-3">
														<a href="javascript:;" data-id="@category.Id" class="menu-link px-3 js-change-status" data-kt-ecommerce-category-filter="delete_row">
															Change Status
														</a>
													</div>
													<!--end::Menu item-->
												</div>
												<!--end::Menu-->
											</td>
										</tr>
									}


								</tbody>
							</table>
						</div>





						<!--end::Table-->
					}
				</div>
				<!--end::Card body-->
			</div>
			<!--end::Category-->
		</div>
		<!--end::Content container-->
	</div>
	<!--end::Content-->

</div>

@Html.AntiForgeryToken()

@section Scripts{
	<script>
		$(document).ready(function(){
			$('.js-change-status').on('click', function () {
				var btn = $(this);
				var id = btn.data('id');

				$.post({
					url:"/Categories/ChangeStatus/"+id,
					data:{
						"__RequestVerificationToken": $("input[name='__RequestVerificationToken']").val()
					},
					success:function(lastUpdatedOn){
						var row = btn.parents('tr');
						var status = row.find('.js-status');

						// change status in badge
						status.html(status.text() == "Deleted" ? "Active" : "Deleted");
						status.toggleClass("badge-light-success badge-light-danger");

						// change time of last updated on 
						row.find('.js-last-updated-on').html(lastUpdatedOn);
					}
				})
			})
		})
	</script>
}
